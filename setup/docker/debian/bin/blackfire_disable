#!/usr/bin/env bash

search=$(find /etc/php/ -iname *blackfire.ini.disable | wc -l)
if [ $search -eq 0 ]
then
  echo -n "Blackfire.io disable in progress... "
else
  echo -n "Blackfire.io already disabled, restart service... "
fi

# Enable xdebug
for f in $(find /etc/php/ -iname *xdebug.ini.disable); do
  sudo mv $f "${f%%.disable}"
done
# Disable blackfire
for f in $(find /etc/php/ -iname *blackfire.ini); do
  sudo mv $f "${f}.disable"
done

# restart services
sudo supervisorctl stop blackfire &> /dev/null || echo "Supervisor not started for blackfire"
if [[ "${DOCKER_WEB_SERVER}" = "apache" ]]; then
  sudo supervisorctl restart apache &> /dev/null || echo "Supervisor not started for apache"
elif [[ "${DOCKER_WEB_SERVER}" = "nginx" ]]; then
  sudo supervisorctl restart php-fpm &> /dev/null || echo "Supervisor not started for php-fpm"
fi

echo "done"
echo "Blackfire disabled and XDebug enabled"