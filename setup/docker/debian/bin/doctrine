#!/usr/bin/env bash

shell_quote() {
    # run in a subshell to protect the caller's environment
    (
        sep=''
        for arg in "$@"; do
            sqesc=$(printf '%s\n' "${arg}" | sed -e "s/'/'\\\\''/g")
            printf '%s' "${sep}'${sqesc}'"
            sep=' '
        done
    )
}

slashes=${PWD//[^\/]/}
tool_path="$PWD"
for (( n=${#slashes}; n>0; --n ))
do
  test -e "$tool_path/bin/doctrine.php" && break
  tool_path="$tool_path/.."
done

tool_path=$(realpath --relative-to=$PWD "$tool_path/bin/doctrine.php")

RUN="php '${tool_path}' $(shell_quote "$@")"
eval "$RUN"
